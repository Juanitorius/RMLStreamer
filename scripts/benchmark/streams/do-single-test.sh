#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

IFS=',' read -ra ADDR <<< "$1"
ID="${ADDR[0]}"
INPUT_FILE_PATH="${ADDR[3]}"
MAPPING_FILE_PATH="${ADDR[4]}"
DELAY="${ADDR[5]}"
PREFIX_URL="${ADDR[6]}"
SUFFIX="${ADDR[7]}"
AMOUNT_TRIPLES="${ADDR[8]}"

MEASUREMENTS_FILE=$2

UUID=$(uuidgen)
TEMP_FOLDER=$(pwd)"/tmp"

mkdir -p $TEMP_FOLDER/$UUID
cp $INPUT_FILE_PATH $TEMP_FOLDER/$UUID
cp $MAPPING_FILE_PATH $TEMP_FOLDER/$UUID

$DIR/do-single-mapping.sh $ID $TEMP_FOLDER/$UUID $(basename $INPUT_FILE_PATH) $DELAY $PREFIX_URL $SUFFIX $AMOUNT_TRIPLES $MEASUREMENTS_FILE

rm -rf $TEMP_FOLDER/$UUID
